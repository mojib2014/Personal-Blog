"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = insertTextAtPosition;

/**
 * The MIT License
 * Copyright (c) 2018 Dmitriy Kubyshkin
 * Copied from https://github.com/grassator/insert-text-at-cursor
 */
var browserSupportsTextareaTextNodes;
/**
 * @param {HTMLElement} input
 * @return {boolean}
 */

function canManipulateViaTextNodes(input) {
  if (input.nodeName !== 'TEXTAREA') {
    return false;
  }

  if (typeof browserSupportsTextareaTextNodes === 'undefined') {
    var textarea = document.createElement('textarea');
    textarea.value = '1';
    browserSupportsTextareaTextNodes = !!textarea.firstChild;
  }

  return browserSupportsTextareaTextNodes;
}
/**
 * @param {HTMLTextAreaElement|HTMLInputElement} input
 * @param {string} text
 * @returns {void}
 */


function insertTextAtPosition(input, text) {
  // Most of the used APIs only work with the field selected
  input.focus(); // IE 8-10

  if (document.selection) {
    var ieRange = document.selection.createRange();
    ieRange.text = text; // Move cursor after the inserted text

    ieRange.collapse(false
    /* to the end */
    );
    ieRange.select();
    return;
  } // Webkit + Edge


  var isSuccess = document.execCommand && document.execCommand('insertText', false, text);

  if (!isSuccess) {
    var start = input.selectionStart;
    var end = input.selectionEnd; // Firefox (non-standard method)

    if (typeof input.setRangeText === 'function') {
      input.setRangeText(text);
    } else {
      // To make a change we just need a Range, not a Selection
      var range = document.createRange();
      var textNode = document.createTextNode(text);

      if (canManipulateViaTextNodes(input)) {
        var node = input.firstChild; // If textarea is empty, just insert the text

        if (!node) {
          input.appendChild(textNode);
        } else {
          // Otherwise we need to find a nodes for start and end
          var offset = 0;
          var startNode = null;
          var endNode = null;

          while (node && (startNode === null || endNode === null)) {
            var nodeLength = node.nodeValue.length; // if start of the selection falls into current node

            if (start >= offset && start <= offset + nodeLength) {
              range.setStart(startNode = node, start - offset);
            } // if end of the selection falls into current node


            if (end >= offset && end <= offset + nodeLength) {
              range.setEnd(endNode = node, end - offset);
            }

            offset += nodeLength;
            node = node.nextSibling;
          } // If there is some text selected, remove it as we should replace it


          if (start !== end) {
            range.deleteContents();
          }
        }
      } // If the node is a textarea and the range doesn't span outside the element
      //
      // Get the commonAncestorContainer of the selected range and test its type
      // If the node is of type `#text` it means that we're still working with text nodes within our textarea element
      // otherwise, if it's of type `#document` for example it means our selection spans outside the textarea.


      if (canManipulateViaTextNodes(input) && range.commonAncestorContainer.nodeName === '#text') {
        // Finally insert a new node. The browser will automatically split start and end nodes into two if necessary
        range.insertNode(textNode);
      } else {
        // If the node is not a textarea or the range spans outside a textarea the only way is to replace the whole value
        var value = input.value;
        input.value = value.slice(0, start) + text + value.slice(end);
      }
    } // Correct the cursor position to be at the end of the insertion


    input.setSelectionRange(start + text.length, start + text.length); // Notify any possible listeners of the change

    var e = document.createEvent('UIEvent');
    e.initEvent('input', true, false);
    input.dispatchEvent(e);
  }
}

module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9JbnNlcnRUZXh0QXRQb3NpdGlvbi50cyJdLCJuYW1lcyI6WyJicm93c2VyU3VwcG9ydHNUZXh0YXJlYVRleHROb2RlcyIsImNhbk1hbmlwdWxhdGVWaWFUZXh0Tm9kZXMiLCJpbnB1dCIsIm5vZGVOYW1lIiwidGV4dGFyZWEiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ2YWx1ZSIsImZpcnN0Q2hpbGQiLCJpbnNlcnRUZXh0QXRQb3NpdGlvbiIsInRleHQiLCJmb2N1cyIsInNlbGVjdGlvbiIsImllUmFuZ2UiLCJjcmVhdGVSYW5nZSIsImNvbGxhcHNlIiwic2VsZWN0IiwiaXNTdWNjZXNzIiwiZXhlY0NvbW1hbmQiLCJzdGFydCIsInNlbGVjdGlvblN0YXJ0IiwiZW5kIiwic2VsZWN0aW9uRW5kIiwic2V0UmFuZ2VUZXh0IiwicmFuZ2UiLCJ0ZXh0Tm9kZSIsImNyZWF0ZVRleHROb2RlIiwibm9kZSIsImFwcGVuZENoaWxkIiwib2Zmc2V0Iiwic3RhcnROb2RlIiwiZW5kTm9kZSIsIm5vZGVMZW5ndGgiLCJub2RlVmFsdWUiLCJsZW5ndGgiLCJzZXRTdGFydCIsInNldEVuZCIsIm5leHRTaWJsaW5nIiwiZGVsZXRlQ29udGVudHMiLCJjb21tb25BbmNlc3RvckNvbnRhaW5lciIsImluc2VydE5vZGUiLCJzbGljZSIsInNldFNlbGVjdGlvblJhbmdlIiwiZSIsImNyZWF0ZUV2ZW50IiwiaW5pdEV2ZW50IiwiZGlzcGF0Y2hFdmVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxJQUFJQSxnQ0FBSjtBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUNBLFNBQVNDLHlCQUFULENBQW1DQyxLQUFuQyxFQUFrRjtBQUNoRixNQUFJQSxLQUFLLENBQUNDLFFBQU4sS0FBbUIsVUFBdkIsRUFBbUM7QUFDakMsV0FBTyxLQUFQO0FBQ0Q7O0FBQ0QsTUFBSSxPQUFPSCxnQ0FBUCxLQUE0QyxXQUFoRCxFQUE2RDtBQUMzRCxRQUFNSSxRQUE2QixHQUFHQyxRQUFRLENBQUNDLGFBQVQsQ0FBdUIsVUFBdkIsQ0FBdEM7QUFDQUYsSUFBQUEsUUFBUSxDQUFDRyxLQUFULEdBQWlCLEdBQWpCO0FBQ0FQLElBQUFBLGdDQUFnQyxHQUFHLENBQUMsQ0FBQ0ksUUFBUSxDQUFDSSxVQUE5QztBQUNEOztBQUNELFNBQU9SLGdDQUFQO0FBQ0Q7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDZSxTQUFTUyxvQkFBVCxDQUE4QlAsS0FBOUIsRUFBNkVRLElBQTdFLEVBQTJGO0FBQ3hHO0FBQ0FSLEVBQUFBLEtBQUssQ0FBQ1MsS0FBTixHQUZ3RyxDQUl4Rzs7QUFDQSxNQUFLTixRQUFELENBQWtCTyxTQUF0QixFQUFpQztBQUMvQixRQUFNQyxPQUFPLEdBQUlSLFFBQUQsQ0FBa0JPLFNBQWxCLENBQTRCRSxXQUE1QixFQUFoQjtBQUNBRCxJQUFBQSxPQUFPLENBQUNILElBQVIsR0FBZUEsSUFBZixDQUYrQixDQUkvQjs7QUFDQUcsSUFBQUEsT0FBTyxDQUFDRSxRQUFSLENBQWlCO0FBQU07QUFBdkI7QUFDQUYsSUFBQUEsT0FBTyxDQUFDRyxNQUFSO0FBRUE7QUFDRCxHQWR1RyxDQWdCeEc7OztBQUNBLE1BQU1DLFNBQVMsR0FBR1osUUFBUSxDQUFDYSxXQUFULElBQXdCYixRQUFRLENBQUNhLFdBQVQsQ0FBcUIsWUFBckIsRUFBbUMsS0FBbkMsRUFBMENSLElBQTFDLENBQTFDOztBQUNBLE1BQUksQ0FBQ08sU0FBTCxFQUFnQjtBQUNkLFFBQU1FLEtBQUssR0FBR2pCLEtBQUssQ0FBQ2tCLGNBQXBCO0FBQ0EsUUFBTUMsR0FBRyxHQUFHbkIsS0FBSyxDQUFDb0IsWUFBbEIsQ0FGYyxDQUdkOztBQUNBLFFBQUksT0FBT3BCLEtBQUssQ0FBQ3FCLFlBQWIsS0FBOEIsVUFBbEMsRUFBOEM7QUFDNUNyQixNQUFBQSxLQUFLLENBQUNxQixZQUFOLENBQW1CYixJQUFuQjtBQUNELEtBRkQsTUFFTztBQUNMO0FBQ0EsVUFBTWMsS0FBSyxHQUFHbkIsUUFBUSxDQUFDUyxXQUFULEVBQWQ7QUFDQSxVQUFNVyxRQUFRLEdBQUdwQixRQUFRLENBQUNxQixjQUFULENBQXdCaEIsSUFBeEIsQ0FBakI7O0FBRUEsVUFBSVQseUJBQXlCLENBQUNDLEtBQUQsQ0FBN0IsRUFBc0M7QUFDcEMsWUFBSXlCLElBQUksR0FBR3pCLEtBQUssQ0FBQ00sVUFBakIsQ0FEb0MsQ0FHcEM7O0FBQ0EsWUFBSSxDQUFDbUIsSUFBTCxFQUFXO0FBQ1R6QixVQUFBQSxLQUFLLENBQUMwQixXQUFOLENBQWtCSCxRQUFsQjtBQUNELFNBRkQsTUFFTztBQUNMO0FBQ0EsY0FBSUksTUFBTSxHQUFHLENBQWI7QUFDQSxjQUFJQyxTQUFTLEdBQUcsSUFBaEI7QUFDQSxjQUFJQyxPQUFPLEdBQUcsSUFBZDs7QUFFQSxpQkFBT0osSUFBSSxLQUFLRyxTQUFTLEtBQUssSUFBZCxJQUFzQkMsT0FBTyxLQUFLLElBQXZDLENBQVgsRUFBeUQ7QUFDdkQsZ0JBQU1DLFVBQVUsR0FBR0wsSUFBSSxDQUFDTSxTQUFMLENBQWdCQyxNQUFuQyxDQUR1RCxDQUd2RDs7QUFDQSxnQkFBSWYsS0FBSyxJQUFJVSxNQUFULElBQW1CVixLQUFLLElBQUlVLE1BQU0sR0FBR0csVUFBekMsRUFBcUQ7QUFDbkRSLGNBQUFBLEtBQUssQ0FBQ1csUUFBTixDQUFnQkwsU0FBUyxHQUFHSCxJQUE1QixFQUFtQ1IsS0FBSyxHQUFHVSxNQUEzQztBQUNELGFBTnNELENBUXZEOzs7QUFDQSxnQkFBSVIsR0FBRyxJQUFJUSxNQUFQLElBQWlCUixHQUFHLElBQUlRLE1BQU0sR0FBR0csVUFBckMsRUFBaUQ7QUFDL0NSLGNBQUFBLEtBQUssQ0FBQ1ksTUFBTixDQUFjTCxPQUFPLEdBQUdKLElBQXhCLEVBQStCTixHQUFHLEdBQUdRLE1BQXJDO0FBQ0Q7O0FBRURBLFlBQUFBLE1BQU0sSUFBSUcsVUFBVjtBQUNBTCxZQUFBQSxJQUFJLEdBQUdBLElBQUksQ0FBQ1UsV0FBWjtBQUNELFdBckJJLENBdUJMOzs7QUFDQSxjQUFJbEIsS0FBSyxLQUFLRSxHQUFkLEVBQW1CO0FBQ2pCRyxZQUFBQSxLQUFLLENBQUNjLGNBQU47QUFDRDtBQUNGO0FBQ0YsT0F2Q0ksQ0F5Q0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0EsVUFBSXJDLHlCQUF5QixDQUFDQyxLQUFELENBQXpCLElBQW9Dc0IsS0FBSyxDQUFDZSx1QkFBTixDQUE4QnBDLFFBQTlCLEtBQTJDLE9BQW5GLEVBQTRGO0FBQzFGO0FBQ0FxQixRQUFBQSxLQUFLLENBQUNnQixVQUFOLENBQWlCZixRQUFqQjtBQUNELE9BSEQsTUFHTztBQUNMO0FBQ0EsWUFBTWxCLEtBQUssR0FBR0wsS0FBSyxDQUFDSyxLQUFwQjtBQUNBTCxRQUFBQSxLQUFLLENBQUNLLEtBQU4sR0FBY0EsS0FBSyxDQUFDa0MsS0FBTixDQUFZLENBQVosRUFBZXRCLEtBQWYsSUFBd0JULElBQXhCLEdBQStCSCxLQUFLLENBQUNrQyxLQUFOLENBQVlwQixHQUFaLENBQTdDO0FBQ0Q7QUFDRixLQTVEYSxDQThEZDs7O0FBQ0FuQixJQUFBQSxLQUFLLENBQUN3QyxpQkFBTixDQUF3QnZCLEtBQUssR0FBR1QsSUFBSSxDQUFDd0IsTUFBckMsRUFBNkNmLEtBQUssR0FBR1QsSUFBSSxDQUFDd0IsTUFBMUQsRUEvRGMsQ0FpRWQ7O0FBQ0EsUUFBTVMsQ0FBQyxHQUFHdEMsUUFBUSxDQUFDdUMsV0FBVCxDQUFxQixTQUFyQixDQUFWO0FBQ0FELElBQUFBLENBQUMsQ0FBQ0UsU0FBRixDQUFZLE9BQVosRUFBcUIsSUFBckIsRUFBMkIsS0FBM0I7QUFDQTNDLElBQUFBLEtBQUssQ0FBQzRDLGFBQU4sQ0FBb0JILENBQXBCO0FBQ0Q7QUFDRiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGhlIE1JVCBMaWNlbnNlXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTggRG1pdHJpeSBLdWJ5c2hraW5cbiAqIENvcGllZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9ncmFzc2F0b3IvaW5zZXJ0LXRleHQtYXQtY3Vyc29yXG4gKi9cblxubGV0IGJyb3dzZXJTdXBwb3J0c1RleHRhcmVhVGV4dE5vZGVzOiBhbnk7XG5cbi8qKlxuICogQHBhcmFtIHtIVE1MRWxlbWVudH0gaW5wdXRcbiAqIEByZXR1cm4ge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGNhbk1hbmlwdWxhdGVWaWFUZXh0Tm9kZXMoaW5wdXQ6IEhUTUxUZXh0QXJlYUVsZW1lbnQgfCBIVE1MSW5wdXRFbGVtZW50KSB7XG4gIGlmIChpbnB1dC5ub2RlTmFtZSAhPT0gJ1RFWFRBUkVBJykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBpZiAodHlwZW9mIGJyb3dzZXJTdXBwb3J0c1RleHRhcmVhVGV4dE5vZGVzID09PSAndW5kZWZpbmVkJykge1xuICAgIGNvbnN0IHRleHRhcmVhOiBIVE1MVGV4dEFyZWFFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTtcbiAgICB0ZXh0YXJlYS52YWx1ZSA9ICcxJztcbiAgICBicm93c2VyU3VwcG9ydHNUZXh0YXJlYVRleHROb2RlcyA9ICEhdGV4dGFyZWEuZmlyc3RDaGlsZDtcbiAgfVxuICByZXR1cm4gYnJvd3NlclN1cHBvcnRzVGV4dGFyZWFUZXh0Tm9kZXM7XG59XG5cbi8qKlxuICogQHBhcmFtIHtIVE1MVGV4dEFyZWFFbGVtZW50fEhUTUxJbnB1dEVsZW1lbnR9IGlucHV0XG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dFxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGluc2VydFRleHRBdFBvc2l0aW9uKGlucHV0OiBIVE1MVGV4dEFyZWFFbGVtZW50IHwgSFRNTElucHV0RWxlbWVudCwgdGV4dDogc3RyaW5nKSB7XG4gIC8vIE1vc3Qgb2YgdGhlIHVzZWQgQVBJcyBvbmx5IHdvcmsgd2l0aCB0aGUgZmllbGQgc2VsZWN0ZWRcbiAgaW5wdXQuZm9jdXMoKTtcblxuICAvLyBJRSA4LTEwXG4gIGlmICgoZG9jdW1lbnQgYXMgYW55KS5zZWxlY3Rpb24pIHtcbiAgICBjb25zdCBpZVJhbmdlID0gKGRvY3VtZW50IGFzIGFueSkuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7XG4gICAgaWVSYW5nZS50ZXh0ID0gdGV4dDtcblxuICAgIC8vIE1vdmUgY3Vyc29yIGFmdGVyIHRoZSBpbnNlcnRlZCB0ZXh0XG4gICAgaWVSYW5nZS5jb2xsYXBzZShmYWxzZSAvKiB0byB0aGUgZW5kICovKTtcbiAgICBpZVJhbmdlLnNlbGVjdCgpO1xuXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gV2Via2l0ICsgRWRnZVxuICBjb25zdCBpc1N1Y2Nlc3MgPSBkb2N1bWVudC5leGVjQ29tbWFuZCAmJiBkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0VGV4dCcsIGZhbHNlLCB0ZXh0KTtcbiAgaWYgKCFpc1N1Y2Nlc3MpIHtcbiAgICBjb25zdCBzdGFydCA9IGlucHV0LnNlbGVjdGlvblN0YXJ0ITtcbiAgICBjb25zdCBlbmQgPSBpbnB1dC5zZWxlY3Rpb25FbmQhO1xuICAgIC8vIEZpcmVmb3ggKG5vbi1zdGFuZGFyZCBtZXRob2QpXG4gICAgaWYgKHR5cGVvZiBpbnB1dC5zZXRSYW5nZVRleHQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGlucHV0LnNldFJhbmdlVGV4dCh0ZXh0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVG8gbWFrZSBhIGNoYW5nZSB3ZSBqdXN0IG5lZWQgYSBSYW5nZSwgbm90IGEgU2VsZWN0aW9uXG4gICAgICBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgICBjb25zdCB0ZXh0Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpO1xuXG4gICAgICBpZiAoY2FuTWFuaXB1bGF0ZVZpYVRleHROb2RlcyhpbnB1dCkpIHtcbiAgICAgICAgbGV0IG5vZGUgPSBpbnB1dC5maXJzdENoaWxkO1xuXG4gICAgICAgIC8vIElmIHRleHRhcmVhIGlzIGVtcHR5LCBqdXN0IGluc2VydCB0aGUgdGV4dFxuICAgICAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgICBpbnB1dC5hcHBlbmRDaGlsZCh0ZXh0Tm9kZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gT3RoZXJ3aXNlIHdlIG5lZWQgdG8gZmluZCBhIG5vZGVzIGZvciBzdGFydCBhbmQgZW5kXG4gICAgICAgICAgbGV0IG9mZnNldCA9IDA7XG4gICAgICAgICAgbGV0IHN0YXJ0Tm9kZSA9IG51bGw7XG4gICAgICAgICAgbGV0IGVuZE5vZGUgPSBudWxsO1xuXG4gICAgICAgICAgd2hpbGUgKG5vZGUgJiYgKHN0YXJ0Tm9kZSA9PT0gbnVsbCB8fCBlbmROb2RlID09PSBudWxsKSkge1xuICAgICAgICAgICAgY29uc3Qgbm9kZUxlbmd0aCA9IG5vZGUubm9kZVZhbHVlIS5sZW5ndGg7XG5cbiAgICAgICAgICAgIC8vIGlmIHN0YXJ0IG9mIHRoZSBzZWxlY3Rpb24gZmFsbHMgaW50byBjdXJyZW50IG5vZGVcbiAgICAgICAgICAgIGlmIChzdGFydCA+PSBvZmZzZXQgJiYgc3RhcnQgPD0gb2Zmc2V0ICsgbm9kZUxlbmd0aCkge1xuICAgICAgICAgICAgICByYW5nZS5zZXRTdGFydCgoc3RhcnROb2RlID0gbm9kZSksIHN0YXJ0IC0gb2Zmc2V0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaWYgZW5kIG9mIHRoZSBzZWxlY3Rpb24gZmFsbHMgaW50byBjdXJyZW50IG5vZGVcbiAgICAgICAgICAgIGlmIChlbmQgPj0gb2Zmc2V0ICYmIGVuZCA8PSBvZmZzZXQgKyBub2RlTGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHJhbmdlLnNldEVuZCgoZW5kTm9kZSA9IG5vZGUpLCBlbmQgLSBvZmZzZXQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBvZmZzZXQgKz0gbm9kZUxlbmd0aDtcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIElmIHRoZXJlIGlzIHNvbWUgdGV4dCBzZWxlY3RlZCwgcmVtb3ZlIGl0IGFzIHdlIHNob3VsZCByZXBsYWNlIGl0XG4gICAgICAgICAgaWYgKHN0YXJ0ICE9PSBlbmQpIHtcbiAgICAgICAgICAgIHJhbmdlLmRlbGV0ZUNvbnRlbnRzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIElmIHRoZSBub2RlIGlzIGEgdGV4dGFyZWEgYW5kIHRoZSByYW5nZSBkb2Vzbid0IHNwYW4gb3V0c2lkZSB0aGUgZWxlbWVudFxuICAgICAgLy9cbiAgICAgIC8vIEdldCB0aGUgY29tbW9uQW5jZXN0b3JDb250YWluZXIgb2YgdGhlIHNlbGVjdGVkIHJhbmdlIGFuZCB0ZXN0IGl0cyB0eXBlXG4gICAgICAvLyBJZiB0aGUgbm9kZSBpcyBvZiB0eXBlIGAjdGV4dGAgaXQgbWVhbnMgdGhhdCB3ZSdyZSBzdGlsbCB3b3JraW5nIHdpdGggdGV4dCBub2RlcyB3aXRoaW4gb3VyIHRleHRhcmVhIGVsZW1lbnRcbiAgICAgIC8vIG90aGVyd2lzZSwgaWYgaXQncyBvZiB0eXBlIGAjZG9jdW1lbnRgIGZvciBleGFtcGxlIGl0IG1lYW5zIG91ciBzZWxlY3Rpb24gc3BhbnMgb3V0c2lkZSB0aGUgdGV4dGFyZWEuXG4gICAgICBpZiAoY2FuTWFuaXB1bGF0ZVZpYVRleHROb2RlcyhpbnB1dCkgJiYgcmFuZ2UuY29tbW9uQW5jZXN0b3JDb250YWluZXIubm9kZU5hbWUgPT09ICcjdGV4dCcpIHtcbiAgICAgICAgLy8gRmluYWxseSBpbnNlcnQgYSBuZXcgbm9kZS4gVGhlIGJyb3dzZXIgd2lsbCBhdXRvbWF0aWNhbGx5IHNwbGl0IHN0YXJ0IGFuZCBlbmQgbm9kZXMgaW50byB0d28gaWYgbmVjZXNzYXJ5XG4gICAgICAgIHJhbmdlLmluc2VydE5vZGUodGV4dE5vZGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSWYgdGhlIG5vZGUgaXMgbm90IGEgdGV4dGFyZWEgb3IgdGhlIHJhbmdlIHNwYW5zIG91dHNpZGUgYSB0ZXh0YXJlYSB0aGUgb25seSB3YXkgaXMgdG8gcmVwbGFjZSB0aGUgd2hvbGUgdmFsdWVcbiAgICAgICAgY29uc3QgdmFsdWUgPSBpbnB1dC52YWx1ZTtcbiAgICAgICAgaW5wdXQudmFsdWUgPSB2YWx1ZS5zbGljZSgwLCBzdGFydCkgKyB0ZXh0ICsgdmFsdWUuc2xpY2UoZW5kKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDb3JyZWN0IHRoZSBjdXJzb3IgcG9zaXRpb24gdG8gYmUgYXQgdGhlIGVuZCBvZiB0aGUgaW5zZXJ0aW9uXG4gICAgaW5wdXQuc2V0U2VsZWN0aW9uUmFuZ2Uoc3RhcnQgKyB0ZXh0Lmxlbmd0aCwgc3RhcnQgKyB0ZXh0Lmxlbmd0aCk7XG5cbiAgICAvLyBOb3RpZnkgYW55IHBvc3NpYmxlIGxpc3RlbmVycyBvZiB0aGUgY2hhbmdlXG4gICAgY29uc3QgZSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdVSUV2ZW50Jyk7XG4gICAgZS5pbml0RXZlbnQoJ2lucHV0JywgdHJ1ZSwgZmFsc2UpO1xuICAgIGlucHV0LmRpc3BhdGNoRXZlbnQoZSk7XG4gIH1cbn1cbiJdfQ==